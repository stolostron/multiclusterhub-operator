
# Source: flightctl/templates/flightctl-api-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: flightctl-api-config
  namespace: {{ .Values.global.namespace }}
data:
  config.yaml: |-
    database:
        hostname: flightctl-db.{{ .Values.global.namespace }}.svc.cluster.local
        type: "pgsql"
        port: 5432
        name: flightctl
    service:
        address: :3443
        agentEndpointAddress: :7443
        httpReadTimeout: "5m"
        httpReadHeaderTimeout: "5m"
        httpWriteTimeout: "5m"
        httpMaxNumHeaders: 32
        httpMaxHeaderBytes: 33010
        httpMaxUrlLength: 2000
        httpMaxRequestSize: 53137200
        baseUrl: https://api.{{ .Values.global.baseDomain }}/
        baseAgentEndpointUrl: https://agent-api.{{ .Values.global.baseDomain }}/
        baseUIUrl: https://console-openshift-console.{{ .Values.global.baseDomain }}/edge
        altNames:
          - api.{{ .Values.global.baseDomain }}
          - agent-api.{{ .Values.global.baseDomain }}
          - flightctl-api
          - flightctl-api.{{ .Values.global.namespace }}
          - flightctl-api.{{ .Values.global.namespace }}.svc.cluster.local
        
        rateLimit:
            requests: 60
            window: 1m
            authRequests: 10
            authWindow: 1h
            trustedProxies:
                - "10.0.0.0/8"
                - "172.16.0.0/12"
                - "192.168.0.0/16"
        
    kv:
        hostname: flightctl-kv.{{ .Values.global.namespace }}.svc.cluster.local
        port: 6379
    
    auth:
        insecureSkipTlsVerify: false
        caCert: 
        k8s:
            apiUrl: https://kubernetes.default.svc
            externalOpenShiftApiUrl: {{ .Values.global.apiUrl }}
            rbacNs: {{ .Values.global.namespace }}
    
    organizations:
        enabled: false
    
    metrics:
        enabled: true
        address: ":15690"
        systemCollector:
            enabled: true
            tickerInterval: 5s
        httpCollector:
            enabled: true
        deviceCollector:
            enabled: true
            tickerInterval: 30s
            groupByFleet: true
        fleetCollector:
            enabled: true
            tickerInterval: 30s
        repositoryCollector:
            enabled: true
            tickerInterval: 30s
        resourceSyncCollector:
            enabled: true
            tickerInterval: 30s
